# build artifacts not automatically cleaned up
# force cleanup, always
# also display installed components and packages
steps:
- task: Bash@3
  displayName: 'apt installed list'
  inputs:
    targetType: inline
    script: apt list --installed
- task: Bash@3
  displayName: 'python version'
  inputs:
    targetType: inline
    script: python3 --version
- task: Bash@3
  displayName: 'list python packages'
  inputs:
    targetType: inline
    script: 'pip list -v'
- task: Bash@3
  displayName: 'set git parallelism'
  inputs:
    targetType: inline
    script: |
      CORES=$(nproc)
      THREADS=$((CORES * 2))
      git config --global pack.threads $THREADS
      git config --global delta.parallel $THREADS
      git config --global index.threads $CORES
- task: DeleteFiles@1
  displayName: 'Cleanup checkout space'
  inputs:
    SourceFolder: '$(Agent.BuildDirectory)/s'
    Contents: '**/*'
- task: DeleteFiles@1
  displayName: 'Cleanup Staging Area'
  inputs:
    SourceFolder: '$(Build.ArtifactStagingDirectory)'
    Contents: '/**/*'
    RemoveDotFiles: true
